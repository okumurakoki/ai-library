import type { Article } from '../types';

/**
 * 記事カテゴリごとのトピック例
 */
const TOPIC_EXAMPLES: Record<string, string[]> = {
  news: [
    'ChatGPT/Claude等の最新AIモデルのアップデート',
    'AI業界の重要なニュース・動向',
    '新しいAIツールやサービスのリリース',
    'AI規制・倫理に関する最新情報',
    'AI活用事例・成功事例の紹介',
  ],
  tips: [
    'プロンプトエンジニアリングのテクニック',
    'AI活用による業務効率化の方法',
    '特定の業務でのAI活用ガイド',
    'AIツールの比較・選び方',
    'AIを使った問題解決の実践例',
  ],
};

/**
 * AIニュース記事のテンプレート
 */
const NEWS_TEMPLATES = [
  {
    titlePattern: '[AIモデル/サービス名]の新機能で[メリット]！実践活用法',
    sections: [
      { title: '概要・背景', level: 2 },
      { title: '主な新機能・変更点', level: 2 },
      { title: 'ビジネスへの影響', level: 2 },
      { title: '実践的な活用例', level: 2 },
      { title: '導入・利用方法', level: 2 },
      { title: '注意点・制限事項', level: 2 },
      { title: '今後の展望', level: 2 },
    ],
  },
  {
    titlePattern: '[企業名/組織名]が発表した[技術/サービス]：[業界]に革新をもたらすか',
    sections: [
      { title: '発表内容のサマリー', level: 2 },
      { title: '技術的な特徴', level: 2 },
      { title: '従来技術との違い', level: 2 },
      { title: '想定される用途', level: 2 },
      { title: '業界への影響', level: 2 },
      { title: '専門家の見解', level: 2 },
      { title: '今後の動向', level: 2 },
    ],
  },
  {
    titlePattern: 'AI規制最前線：[地域/国]の新しいガイドライン・法規制',
    sections: [
      { title: '規制の背景', level: 2 },
      { title: '主な規制内容', level: 2 },
      { title: '対象となる企業・サービス', level: 2 },
      { title: 'コンプライアンス対応', level: 2 },
      { title: 'ビジネスへの影響', level: 2 },
      { title: '他地域との比較', level: 2 },
      { title: '今後の展開', level: 2 },
    ],
  },
];

/**
 * 使い方記事のテンプレート
 */
const TIPS_TEMPLATES = [
  {
    titlePattern: '[業務/タスク]を効率化する[AIツール]活用ガイド',
    sections: [
      { title: 'この記事で学べること', level: 2 },
      { title: '対象読者', level: 2 },
      { title: '現状の課題', level: 2 },
      { title: '基本的な使い方', level: 2 },
      { title: '実践的な活用手順', level: 2 },
      { title: '具体的な活用例', level: 2 },
      { title: 'よくある質問', level: 2 },
      { title: 'さらに活用するためのヒント', level: 2 },
    ],
  },
  {
    titlePattern: 'プロンプトエンジニアリング実践：[テーマ]で成果を出す書き方',
    sections: [
      { title: 'プロンプトエンジニアリングとは', level: 2 },
      { title: '良いプロンプトの条件', level: 2 },
      { title: '重要なポイント', level: 2 },
      { title: '実例比較：効果的な書き方', level: 2 },
      { title: '実践的なテンプレート', level: 2 },
      { title: '応用テクニック', level: 2 },
      { title: 'トラブルシューティング', level: 2 },
      { title: 'まとめ', level: 2 },
    ],
  },
  {
    titlePattern: 'AI初心者から上級者まで：[目的]を達成するための完全ガイド',
    sections: [
      { title: 'はじめに', level: 2 },
      { title: '基礎知識', level: 2 },
      { title: '実践的な使い方', level: 2 },
      { title: '応用テクニック', level: 2 },
      { title: '上級者向けカスタマイズ', level: 2 },
      { title: 'ケーススタディ', level: 2 },
      { title: '役立つリソースとツール', level: 2 },
      { title: '次のステップ', level: 2 },
    ],
  },
];

/**
 * AI記事を生成する
 */
export async function generateArticle(
  category: 'news' | 'tips',
  topic: string,
  keywords: string[]
): Promise<Article> {
  // TODO: 実際のAI API呼び出しに置き換える
  await new Promise((resolve) => setTimeout(resolve, 2000));

  const templates = category === 'news' ? NEWS_TEMPLATES : TIPS_TEMPLATES;
  const template = templates[Math.floor(Math.random() * templates.length)];

  // タイトル生成
  const title = generateTitle(category, topic, template);

  // 本文生成
  const content = generateContent(category, topic, keywords, template);

  const article: Article = {
    id: `article-${Date.now()}`,
    title,
    content,
    category,
    author: 'AI Library編集部',
    publishedAt: new Date().toISOString(),
    isPublished: false, // デフォルトは非公開
  };

  return article;
}

/**
 * タイトルを生成
 */
function generateTitle(
  category: 'news' | 'tips',
  topic: string,
  _template: { titlePattern: string; sections: { title: string; level: number }[] }
): string {
  if (category === 'news') {
    return `${topic}の最新動向と実践活用法`;
  } else {
    return `${topic}の実践ガイド`;
  }
}

/**
 * 本文を生成（マークダウン形式）
 */
function generateContent(
  category: 'news' | 'tips',
  topic: string,
  keywords: string[],
  template: { titlePattern: string; sections: { title: string; level: number }[] }
): string {
  const k1 = keywords[0] || '効率化';
  const k2 = keywords[1] || '最適化';
  const k3 = keywords[2] || '活用法';

  if (category === 'news') {
    return `${topic}について、最近の動きをまとめました。実際のビジネスでどう使えるのか、具体的に見ていきましょう。

## ${template.sections[0].title}

最近、${topic}が注目を集めています。というのも、導入する企業が増えてきて、実際に使える技術として認知されてきたからです。

市場を見てみると、こんな変化が起きています。

- 導入する企業がじわじわ増えている
- 使い方のバリエーションが広がってきた
- 投資する金額も大きくなってきている

要するに、「試しに使ってみる」段階から「本格的に業務に組み込む」段階に移ってきたということですね。

## ${template.sections[1].title}

注目すべきポイントをいくつか挙げてみます。

### 1. ${k1}が実現できる

今までできなかったことができるようになる、というのが一番大きいですね。具体的には：

- 作業時間が大幅に減る
- ミスが減って品質が上がる
- コストも抑えられる

実際、導入した企業からは「こんなに楽になるとは思わなかった」という声が多いです。

### 2. ${k2}で使いやすくなった

専門的な知識がなくても使えるように工夫されています。インターフェースも直感的なので、説明書を読まなくてもある程度使えちゃいます。

### 3. ${k3}の幅が広い

いろんな業務に対応できるのも魅力です。自社の使い方に合わせてカスタマイズもできるので、「うちには合わない」ということが少ないんですよね。

## ${template.sections[2].title}

どの業界で使われているのか、主なものを見てみましょう。

**製造業**
工場の生産ラインを効率化したり、品質チェックを自動化したりと、かなり使われています。人手不足の解消にもつながっているそうです。

**サービス業**
お客さん対応が楽になったという声が多いですね。一人ひとりに合わせた対応ができるようになって、満足度も上がっているとか。

**金融業**
リスク判断とか、投資の意思決定とか、慎重な判断が必要な場面で活躍しています。データを瞬時に分析できるのが強みですね。

**医療分野**
診断のサポートや、カルテ入力などの事務作業の効率化に使われています。医師が本来の診療に集中できる時間が増えたという報告も。

## ${template.sections[3].title}

実際にどんな使い方をされているのか、いくつか例を紹介しますね。

### ${k1}の事例

毎日やってる定型業務を自動化したら、社員がもっとクリエイティブな仕事に時間を使えるようになったという話があります。ある会社では、作業時間が40%も減ったそうです。浮いた時間で新しいプロジェクトを始められたとか。

### ${k2}の導入例

膨大なデータを分析して、経営判断の材料を出してくれるんです。今まで勘と経験で決めてた部分が、データに基づいて判断できるようになった。しかも判断スピードも上がったという声が多いですね。

### ${k3}の実践

お客さん一人ひとりに合わせたサービスができるようになって、満足度がグッと上がったという報告も。細かくカスタマイズできるのが強みだそうです。

## ${template.sections[4].title}

導入するなら、こんな流れがおすすめです。

### ステップ1：現状を整理する
まずは自社の課題をはっきりさせましょう。「何をどうしたいのか」「どんな効果を期待するのか」を具体的に書き出してみるといいですよ。

### ステップ2：小さく試してみる
いきなり全社導入は危険です。まずは一部の部署で試してみて、本当に効果があるか確認しましょう。失敗してもダメージが少ないですからね。

### ステップ3：徐々に広げる
うまくいった部分から、他の部署にも展開していきます。焦らず段階的に進めるのがコツです。一気にやると混乱しますから。

### ステップ4：改善を続ける
使ってみて気づいたことは、どんどん改善していきましょう。定期的に見直すことで、より効果的な使い方が見つかります。

## ${template.sections[5].title}

ただし、気をつけておきたいポイントもあります。

- **セキュリティは最優先** - データの扱いには十分注意してください。情報漏洩したら大変なことになりますからね
- **既存システムとの相性** - 今使ってるシステムと連携できるか、事前にしっかり確認しておきましょう
- **社員の教育も大事** - 新しいツールに慣れるまで時間がかかります。研修の時間は十分に取っておいた方がいいです
- **費用対効果をチェック** - かけたコストに見合う効果が出るのか、冷静に判断してください

## ${template.sections[6].title}

この分野、まだまだ伸びていきそうです。早めに取り入れた企業は、すでに競合と差をつけ始めています。

最新情報はこまめにチェックして、自社に使えそうなものがあれば試してみる。そういう姿勢が大事だと思います。技術の進化は本当に速いので、油断するとすぐ置いていかれますよ。`;
  } else {
    // tips記事
    return `${topic}について、実践的な使い方をまとめました。基礎から応用まで、すぐに使える知識とコツを紹介していきます。

## ${template.sections[0].title}

この記事を読むと、こんなことが分かります。

- 基本的な考え方と押さえておくべきポイント
- 実際の手順を一つずつ
- よくつまずくところと、その解決方法
- もっと効率よく使うためのコツ

実務で使うことを前提に書いているので、読んだらすぐ試せる内容になってます。

## ${template.sections[1].title}

こんな人に読んでほしいです。

- ${topic}を初めて使う人
- 基本は分かってるけど、もっと楽にできる方法を知りたい人
- 実務で使える具体的なやり方を探している人
- チーム全員のレベルを上げたい人

初心者から中級者まで、誰が読んでも役に立つ内容にしています。

## ${template.sections[2].title}

${topic}を使おうとすると、こんな壁にぶつかることが多いです。

### 課題1：${k1}の悩み

情報が多すぎて、どこから始めればいいか分からなくなりますよね。何から手をつけるべきか、優先順位がつけられないという声をよく聞きます。

### 課題2：${k2}がうまくいかない

試してはみたものの、思ったような結果が出ない。「こんなはずじゃなかったのに...」って感じること、ありますよね。

### 課題3：${k3}に時間がかかる

効率的なやり方が分からなくて、無駄に時間を使ってしまう。もっと早くできる方法があるはずなんだけど...と悩んでいる人も多いはず。

こういった悩みを解決する方法を、これから紹介していきますね。

## ${template.sections[3].title}

まずは基本的な考え方を押さえておきましょう。${topic}をうまく使うための3つの原則です。

### 原則1：ゴールをはっきりさせる

「何がしたいのか」を具体的にしておくことが超重要です。ふわっとした目標だと、結局うまくいきません。「○○を△△する」みたいに、できるだけ具体的に決めましょう。

### 原則2：小さく始める

最初から完璧を目指すと疲れます。まずは小さく始めて、徐々にレベルアップしていくのがコツ。失敗してもダメージが少ないですしね。

### 原則3：改善し続ける

一度やって終わりじゃなく、使いながら「もっといい方法ないかな？」って考え続けることが大事。そうやってPDCAを回していくと、どんどん上手くなっていきます。

## ${template.sections[4].title}

それでは、実際の手順を見ていきましょう。

### 準備フェーズ

まずは以下を確認します。

- 必要なツールやリソースの洗い出し
- 作業環境の整備
- 基本的な用語と概念の理解

準備を丁寧に行うことで、スムーズに進められます。

### 実践フェーズ

基本的な実践を積み重ねます。

- 簡単な例から始める
- 基本パターンを身につける
- よくあるミスを避ける

最初は小さな成功体験を積むことを重視しましょう。

### 応用フェーズ

徐々にレベルを上げていきます。

- 自分の用途に合わせてカスタマイズ
- 効率化のテクニックを適用
- 高度な機能を活用する

基礎が固まったら、応用にチャレンジします。

### 改善フェーズ

継続的に質を高めます。

- 結果を評価する
- フィードバックを収集
- 運用を最適化する

定期的な振り返りが重要です。

## ${template.sections[5].title}

実務で即使えるテンプレートと具体例をご紹介します。

### ${k1}のテンプレート

最も一般的なケースに対応したテンプレートです。このパターンは汎用性が高く、多くの場面で活用できます。

自社の状況に合わせて調整してご利用ください。カスタマイズのポイントも合わせて説明します。

### ${k2}のテンプレート

より複雑なニーズに対応する場合のテンプレートです。高度な要件がある場合は、こちらを参考にしてください。

段階的に複雑さを増していくアプローチが効果的です。

### ${k3}のテンプレート

大量の作業を効率的に処理する際に活用できるテンプレートです。スケーラビリティを重視した設計になっています。

繰り返し作業を自動化したい場合に特に有効です。

## ${template.sections[6].title}

実践する中でよくある質問と回答をまとめました。

**Q：うまくいかない場合はどうすればいいですか？**

A：まず、基本的な手順を確認しましょう。多くの場合、小さな見落としが原因です。一つ一つのステップを丁寧に確認することをお勧めします。

**Q：もっと効率的な方法はありますか？**

A：はい、状況に応じて様々な最適化が可能です。この記事で紹介したヒントを参考に、自分に合った方法を見つけてください。

**Q：チーム全体で活用するにはどうすればいいですか？**

A：ドキュメント化と定期的な知識共有が効果的です。ベストプラクティスを組織全体で共有することで、チーム全体のレベルが向上します。

## ${template.sections[7].title}

さらに活用を深めるためのヒントをご紹介します。

- 定期的に最新情報をチェックし、新しいテクニックを取り入れる
- コミュニティで他のユーザーと情報交換し、知見を広げる
- 自分なりのベストプラクティスをドキュメント化し、資産として蓄積する
- 継続的な学習と実験を習慣化し、スキルを磨き続ける

${topic}を効果的に活用することで、業務効率は大きく向上します。この記事の内容を実践し、自分なりの活用方法を見つけてください。`;
  }
}

/**
 * 複数の記事を一括生成
 */
export async function generateMultipleArticles(
  category: 'news' | 'tips',
  count: number
): Promise<Article[]> {
  const articles: Article[] = [];
  const topics = TOPIC_EXAMPLES[category];

  for (let i = 0; i < count; i++) {
    const topic = topics[i % topics.length];
    const keywords = ['機能強化', '効率化', 'ベストプラクティス'];

    await new Promise((resolve) => setTimeout(resolve, 100)); // 少し待機

    const article = await generateArticle(category, topic, keywords);
    articles.push(article);
  }

  return articles;
}
