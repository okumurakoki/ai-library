import type { Prompt } from '../types';

/**
 * メタプロンプト: AIに高品質なプロンプトを生成させるための指示
 * Note: 現在はデモ実装で使用していないが、将来的な拡張用に定義を保持
 */
// @ts-expect-error - 将来のAI API統合のために保持
const _META_PROMPT = `あなたはプロフェッショナルなプロンプトエンジニアです。ユーザーが指定したカテゴリと業務内容に基づいて、実用的で高品質なAIプロンプトを生成してください。

【生成するプロンプトの品質基準】
1. **明確性**: 何を求めているか明確に指示
2. **具体性**: 抽象的ではなく具体的な指示と例を含む
3. **構造化**: セクション分けして読みやすく整理
4. **文脈提供**: AI が適切な役割を理解できる背景情報
5. **出力形式の指定**: 期待する成果物の形式を明示
6. **実用性**: 実際のビジネスシーンで即座に使える内容

【プロンプトの構成要素】
- ロール設定（「あなたは〜の専門家です」）
- タスクの明確な定義
- 入力情報のプレースホルダー（[変数名]形式）
- 要件・制約条件の箇条書き
- 期待する出力形式の指定
- 具体例やテンプレート

【注意事項】
- 業界用語を適切に使用
- 実務経験者が作成したような自然な文章
- 汎用性と具体性のバランス
- コピー&ペーストで即使える実用性`;

/**
 * カテゴリごとの業務コンテキスト情報
 */
const CATEGORY_CONTEXTS: Record<string, string> = {
  'real-estate': '不動産業界では、物件情報の魅力的な訴求、契約書の確認、顧客対応、投資分析などが重要です。',
  'accounting': '経理・会計では、正確な財務処理、レポート作成、税務対応、経営分析などが求められます。',
  'marketing': 'マーケティングでは、ターゲット分析、コンテンツ作成、キャンペーン企画、効果測定が重要です。',
  'legal': '法務では、契約書レビュー、リスク評価、コンプライアンス確認、紛争対応が中心業務です。',
  'hr': '人事・採用では、求人作成、面接評価、人材育成、労務管理が主要業務です。',
  'sales': '営業では、提案書作成、顧客ニーズ把握、クロージング、関係構築が重要です。',
  'support': 'カスタマーサポートでは、問い合わせ対応、クレーム処理、FAQ作成、顧客満足度向上が求められます。',
  'engineering': 'IT・エンジニアリングでは、設計書作成、コードレビュー、技術選定、障害対応が中心です。',
  'education': '教育では、カリキュラム設計、教材作成、評価基準設定、学習効果測定が重要です。',
  'healthcare': '医療・ヘルスケアでは、患者説明、記録管理、安全管理、チーム連携が求められます。',
  'restaurant': '飲食では、メニュー開発、接客品質、在庫管理、衛生管理が重要です。',
  'manufacturing': '製造業では、工程管理、品質管理、コスト削減、安全対策が中心業務です。',
  'retail': '小売・ECでは、商品企画、在庫管理、顧客体験向上、販売促進が重要です。',
  'finance': '金融では、リスク評価、商品説明、コンプライアンス、顧客資産管理が求められます。',
  'consulting': 'コンサルティングでは、課題分析、戦略立案、実行支援、成果測定が中心業務です。',
};

/**
 * プロンプトテンプレートのパターン
 */
const PROMPT_PATTERNS = [
  {
    name: '詳細な文書作成支援',
    template: (context: string) => `あなたは${context}における10年以上の実務経験を持つベテランの文書作成コンサルタントです。業界のベストプラクティスと最新のトレンドを熟知しており、読み手に響く説得力のある文書を作成することができます。

以下の情報をもとに、プロフェッショナルで説得力のある文書を作成してください。

【入力情報】
以下の各項目について、できるだけ詳細に情報を提供してください：

- 文書の目的: [この文書で達成したい具体的な目標]
- 対象読者: [読者の属性、役職、専門知識レベル、関心事]
- 背景情報: [この文書が必要となった経緯、現状の課題]
- 主要なメッセージ: [最も伝えたい核心的なポイント3-5点]
- 補足データ: [裏付けとなる数値、事例、引用など]
- トーン: [フォーマル/カジュアル/技術的/営業的など]
- 文字数/ページ数: [目安となるボリューム]
- 締切・納期: [提出期限や使用タイミング]

【作成要件】
以下の要素を必ず含めてください：

1. **説得力**: データや具体例を用いた論理的な構成
2. **明確性**: 専門用語を使う場合は適切な説明を付ける
3. **行動喚起**: 読者に取ってほしい次のアクションを明示
4. **視覚的構成**: 見出し、箇条書き、番号付きリストで読みやすく
5. **ストーリー性**: 導入→本論→結論の流れを意識
6. **差別化**: 他の類似文書との差別化ポイント

【文書の構成】
以下の構成に従って作成してください：

1. **タイトル/件名**
   - 一目で内容が分かる簡潔なタイトル
   - サブタイトルで詳細を補足（必要に応じて）

2. **エグゼクティブサマリー**（100-150文字）
   - 文書全体の要点を凝縮
   - 忙しい読者でも核心を理解できる内容

3. **背景・目的**（200-300文字）
   - なぜこの文書が必要なのか
   - 読者にとっての関連性・重要性

4. **本論**（メインコンテンツ）
   - セクション1: [具体的なセクション名]
   - セクション2: [具体的なセクション名]
   - セクション3: [具体的なセクション名]
   ※各セクションには小見出しと具体例を含める

5. **結論・まとめ**（150-200文字）
   - 主要ポイントの再確認
   - 期待される効果や次のステップ

6. **アクションアイテム/推奨事項**
   - 読者が取るべき具体的な行動を箇条書き
   - 優先順位や期限を明記

【留意点】
- ${context}の業界標準や規制に準拠した内容にする
- 事実と意見を明確に区別する
- 必要に応じて参考資料や出典を記載する
- 読者の立場や利益を常に意識した表現を使う
- ポジティブな表現を心がけ、問題点を指摘する際も建設的に
- 専門用語の使用は読者のレベルに合わせて調整する

【品質チェックポイント】
作成後、以下の点を確認してください：
✓ 文法・スペルミスはないか
✓ 論理の飛躍や矛盾はないか
✓ データや事例は正確で信頼できるか
✓ 読者にとって価値のある情報が含まれているか
✓ 行動を促す明確なメッセージがあるか`,
  },
  {
    name: '多角的な分析・評価レポート',
    template: (context: string) => `あなたは${context}分野において高度な分析力を持つシニアアナリストです。複雑なデータから意味のある洞察を引き出し、経営層が意思決定に活用できる実用的なレポートを作成することができます。

以下のデータ・情報を多角的に分析し、アクションにつながる実用的な洞察を提供してください。

【分析対象の詳細】
以下の情報をできるだけ具体的に提供してください：

- 分析データ: [具体的な数値、指標、トレンド、期間]
- データソース: [データの出所、信頼性、更新頻度]
- 比較基準: [前年比、業界平均、目標値など]
- 分析の目的: [この分析で明らかにしたいこと]
- 意思決定者: [分析結果を使う人の役職や関心事]
- 制約条件: [時間、予算、リソースなどの制約]
- 過去の施策: [これまでに実施した対策とその結果]

【分析のフレームワーク】
以下の観点から体系的に分析を実施してください：

1. **定量分析**
   - 主要指標（KPI）の推移と現状評価
   - 統計的な傾向分析（トレンド、季節性、異常値）
   - セグメント別の比較分析
   - 相関関係や因果関係の検証

2. **定性分析**
   - 数値に現れない要因の特定
   - ステークホルダーの意見や反応
   - 市場環境や競合の動向
   - 組織文化や業務プロセスの影響

3. **SWOT分析**
   - Strengths（強み）: 現在の優位性
   - Weaknesses（弱み）: 改善が必要な領域
   - Opportunities（機会）: 活用できる外部要因
   - Threats（脅威）: 対処すべきリスク

4. **根本原因分析**
   - 問題の表面的な症状ではなく根本原因を特定
   - 5Why分析や魚骨図（イシカワダイアグラム）の活用
   - 複数の要因が絡む場合の関連性の整理

【求める分析結果】

**1. エグゼクティブサマリー**（200-250文字）
- 最も重要な発見を3-5点で簡潔に
- 経営層が30秒で理解できる内容
- 推奨アクションを1-2点明記

**2. 現状評価**（詳細）
- 各KPIの現状値と目標との乖離
- ポジティブな点とネガティブな点を明確に区別
- 業界標準や競合との比較
- グラフや表を用いた視覚的な説明

**3. 問題点・課題の特定**
- 優先度順に課題をリストアップ
- 各課題のインパクト（大/中/小）と緊急度を評価
- 放置した場合の潜在的リスク
- 課題間の相互関係や依存性

**4. 改善提案**
- 短期的な対策（1-3ヶ月）: すぐに実行できる施策
- 中期的な対策（3-12ヶ月）: 計画的に進める施策
- 長期的な対策（1年以上）: 抜本的な改革や投資
- 各提案の期待効果、必要リソース、リスク評価

**5. 優先順位付け**
- 効果とコストのマトリクス（クイックウィン、戦略的投資など）
- 推奨する実施順序とその理由
- リソース配分の提案

**6. 実行計画の概要**
- 具体的なアクションステップ
- 担当者・責任者の想定
- マイルストーンとKPI
- 進捗モニタリングの方法

【出力形式】

■ エグゼクティブサマリー
[簡潔な要約]

■ 分析概要
期間: [分析対象期間]
対象: [分析対象の詳細]
主要指標: [使用したKPI]

■ 主要な発見（Key Findings）
1. [発見1 + データの裏付け]
2. [発見2 + データの裏付け]
3. [発見3 + データの裏付け]

■ 詳細分析
[各観点からの分析結果]

■ 課題の優先順位
【最優先課題】
- 課題: [内容]
- 影響度: [大/中/小]
- 緊急度: [高/中/低]
- 推奨対策: [具体的なアクション]

【重要課題】
[同様の形式で記載]

■ 推奨アクション
[優先順位順に実行すべき施策]

■ 次のステップ
[この分析結果を受けて取るべき行動]

【分析の質を高めるポイント】
- 主観ではなく客観的なデータに基づく
- 複数の仮説を立てて検証する
- 楽観的すぎず、悲観的すぎない現実的な評価
- ${context}の業界知識を活かした専門的な洞察
- 実行可能性を重視した提案`,
  },
  {
    name: '実務で使える詳細チェックリスト',
    template: (context: string) => `あなたは${context}における品質管理と業務効率化のエキスパートです。長年の実務経験から、見落としがちな重要ポイントを熟知しており、実務で即座に活用できる実用的なチェックリストを作成することができます。

以下のタスクに対する包括的で実用的なチェックリストを作成してください。

【対象タスクの詳細】
- タスク名: [具体的なタスク名]
- タスクの目的: [このタスクで達成すべきゴール]
- 実施頻度: [毎日/週次/月次/プロジェクト毎など]
- 関係者: [タスクに関わる人や部門]
- 前提条件: [タスク開始前に満たすべき条件]
- 成果物: [タスク完了時に得られるアウトプット]
- 所要時間: [標準的な作業時間]
- リスク: [このタスクで起こりやすいミスや問題]

【チェックリストの品質基準】

1. **具体性**: 「確認する」ではなく「何を、どのように確認するか」まで明記
2. **実用性**: 現場ですぐに使える、曖昧さのない表現
3. **網羅性**: 抜け漏れのない包括的なカバレッジ
4. **優先順位**: 重要度と緊急度が明確
5. **効率性**: チェック順序が作業フローに沿っている
6. **学習要素**: なぜそのチェックが必要かの理由も記載

【チェック項目の分類と詳細】

**【フェーズ1: 事前準備】必須チェック項目**

1. ☐ [チェック項目1]
   - チェック方法: [具体的な確認手順]
   - 判断基準: [OK/NGの判断基準]
   - 重要度: ★★★
   - なぜ重要か: [このチェックが必要な理由]
   - よくある落とし穴: [見落としがちなポイント]

2. ☐ [チェック項目2]
   [同様の形式で5-10項目]

**【フェーズ2: 実行中】必須チェック項目**

[実際の作業中に確認すべき10-15項目を同様の形式で記載]

**【フェーズ3: 完了確認】必須チェック項目**

[タスク完了時に確認すべき8-12項目を同様の形式で記載]

**【品質保証】推奨チェック項目**

必須ではないが、品質を高めるために推奨される項目：

1. ☐ [推奨項目1]
   - 効果: [このチェックによる品質向上の内容]
   - 追加時間: [このチェックに要する時間]
   - 優先度: 中

[5-7項目を記載]

**【付加価値】オプションチェック項目**

余裕があれば実施すると良い項目：

1. ☐ [オプション項目1]
   - 期待効果: [実施した場合のメリット]
   - スキップ可能な条件: [省略しても問題ない場合]

[3-5項目を記載]

**【リスク管理】特に注意すべきポイント**

⚠️ クリティカルチェック項目（絶対に見落としてはいけない）：

1. 🔴 [最重要チェック1]
   - 見落とした場合の影響: [具体的なリスクやコスト]
   - 二重チェックの推奨: [誰が、いつ確認するか]
   - 過去の失敗事例: [実際にあったトラブル例]

[3-5項目を記載]

**【効率化のヒント】**

このチェックリストを使う際の実務的なアドバイス：

- 初回は全項目をチェック、2回目以降は重要度★★★を優先
- チーム内で役割分担する場合の推奨分担方法
- デジタルツール活用の提案（スプレッドシート、専用アプリなど）
- 定期的な見直しのタイミング（月次/四半期）
- 自動化できる項目の提案

**【カスタマイズガイド】**

このチェックリストをあなたの環境に合わせて調整する方法：

- 自社の基準やポリシーに合わせて追加すべき項目
- 業務規模に応じた項目の増減の推奨
- 使用するツールやシステムに応じた項目の調整

**【記録と改善】**

□ チェック実施日: ___/___/___
□ チェック実施者: ___________
□ 所要時間: _____分
□ 発見した問題点: ___________
□ 改善提案: ___________

【補足資料】
- 関連する社内規定やマニュアルへの参照
- 外部の業界標準やベストプラクティス
- トラブルシューティングガイド
- よくある質問（FAQ）`,
  },
  {
    name: '戦略的な提案・企画書',
    template: (context: string) => `あなたは${context}における戦略立案とビジネス企画のスペシャリストです。経営層を説得し、プロジェクトを成功に導く提案書を数多く作成してきた実績があります。データに基づく論理的な提案と、実現可能性の高い実行計画を組み合わせた説得力のある企画書を作成できます。

以下の状況に基づいて、承認を得られる効果的な提案書を作成してください。

【提案の背景情報】

**現状分析**
- 現在の状況: [具体的な現状と課題の詳細]
- 問題の規模: [影響を受けている範囲、関係者数、経済的影響]
- 問題の深刻度: [このまま放置した場合の将来的なリスク]
- これまでの対応: [過去に実施した対策とその結果]
- 競合の動向: [業界や競合他社の状況]
- 市場環境: [外部環境の変化や規制の動向]

**ステークホルダー分析**
- 意思決定者: [役職、関心事、判断基準]
- 影響を受ける部門: [各部門の立場や懸念事項]
- 予算承認者: [財務的な判断基準]
- 実行チーム: [実際に作業を担当する人々]

【提案の目的と目標】
- 最終ゴール: [この提案で達成したい最終的な状態]
- 定量的目標: [具体的な数値目標とKPI]
- 定性的目標: [数値化できない価値や効果]
- タイムフレーム: [目標達成の期限]

【提案書の構成】

**1. エグゼクティブサマリー**（A4で1ページ以内）

• 提案の要点
  - 何を提案するのか（一文で）
  - なぜ今なのか（緊急性と重要性）
  - 期待される効果（定量的・定性的）
  - 必要な投資額と期間

• 推奨する決定
  - 承認をお願いする事項
  - 次のステップ
  - 意思決定の期限

**2. 現状分析と課題の整理**（2-3ページ）

• 定量的な現状把握
  - 主要指標の推移（過去2-3年）
  - 業界平均との比較
  - トレンド分析とグラフ化

• 問題の構造化
  - 表面的な症状
  - 根本的な原因
  - 要因の関連図

• 影響とコスト
  - 現在発生している損失やコスト
  - 機会損失の試算
  - 将来的なリスク予測

**3. 解決策の提案**（3-4ページ）

**提案A: [提案名]**（推奨案）

• 概要と特徴
  [200-300文字で簡潔に]

• 具体的な実施内容
  - アクション1: [詳細な説明]
  - アクション2: [詳細な説明]
  - アクション3: [詳細な説明]

• 差別化ポイント
  - なぜこのアプローチが最適なのか
  - 他の方法との違い
  - 独自性や優位性

• 期待される効果
  - 直接的な効果: [具体的な数値と根拠]
  - 間接的な効果: [副次的なメリット]
  - 短期的効果（3-6ヶ月）
  - 中長期的効果（1-3年）

• 成功事例
  - 類似の成功事例（社内外）
  - 具体的な成果データ
  - 自社への適用可能性

**提案B: [代替案1]**

[同様の形式で、推奨案より簡潔に記載]

**提案C: [代替案2]**

[同様の形式で、推奨案より簡潔に記載]

**比較表**

| 評価項目 | 提案A | 提案B | 提案C | 現状維持 |
|---------|------|------|------|----------|
| 初期投資額 | [金額] | [金額] | [金額] | ¥0 |
| 年間運用コスト | [金額] | [金額] | [金額] | [金額] |
| 期待ROI（3年） | [%] | [%] | [%] | - |
| 実現難易度 | [高/中/低] | [高/中/低] | [高/中/低] | - |
| リスクレベル | [高/中/低] | [高/中/低] | [高/中/低] | [高] |
| 実施期間 | [ヶ月] | [ヶ月] | [ヶ月] | - |

**4. 投資対効果（ROI）分析**（1-2ページ）

• 初期投資の内訳
  - 人件費: [詳細]
  - システム・ツール費用: [詳細]
  - 外部委託費: [詳細]
  - その他: [詳細]
  - 合計: [金額]

• 年間ランニングコスト
  [同様に内訳を記載]

• 期待される収益・削減効果
  - 年次別の効果予測
  - 累積効果のグラフ
  - 損益分岐点の計算

• ROI計算
  - 計算式: [明示]
  - ROI: [%]
  - 投資回収期間: [ヶ月/年]

**5. 実施計画とスケジュール**（2-3ページ）

• フェーズ別の実施計画

**準備フェーズ（Month 1-2）**
- Week 1-2: [具体的なタスク]
  - 担当: [部門/担当者]
  - 成果物: [具体的なアウトプット]
  - マイルストーン: [確認ポイント]

[同様に週単位または月単位で計画を記載]

**実行フェーズ（Month 3-6）**
[同様の形式]

**定着フェーズ（Month 7-12）**
[同様の形式]

• リソース計画
  - 必要な人員とスキル
  - 外部リソースの活用
  - 既存業務との調整

• 進捗管理とKPI
  - 週次で確認する指標
  - 月次で確認する指標
  - フェーズゲートでの判断基準

**6. リスク分析と対策**（1-2ページ）

| リスク項目 | 発生確率 | 影響度 | 対策 | 担当 |
|-----------|---------|-------|------|-----|
| [リスク1] | 高/中/低 | 大/中/小 | [具体的な対策] | [部門] |
| [リスク2] | 高/中/低 | 大/中/小 | [具体的な対策] | [部門] |

• コンティンジェンシープラン
  - 最悪のシナリオと対応策
  - 早期警戒指標
  - エスカレーションルート

**7. 推奨アクションと次のステップ**

• 即座に実施すべきこと
  1. [アクション1 - 期限]
  2. [アクション2 - 期限]
  3. [アクション3 - 期限]

• 承認後のアクション
  - Week 1: [具体的なタスク]
  - Week 2-4: [具体的なタスク]

• 意思決定のお願い
  - 承認いただきたい事項
  - 決定期限: [日付]
  - 承認後の開始予定: [日付]

**8. Q&A（想定質問と回答）**

Q1: [コストに関する質問]
A: [データに基づく回答]

Q2: [実現可能性に関する質問]
A: [根拠を示した回答]

Q3: [リスクに関する質問]
A: [対策を含めた回答]

[5-10問を想定]

**9. 参考資料・補足情報**

• データの出典
• 参考にした事例や文献
• 詳細な計算根拠
• 関連する社内規定やポリシー

【提案書作成のポイント】

1. **説得力**:
   - 主観ではなく客観的データに基づく
   - 具体的な数値と根拠を明示
   - ビフォー・アフターを明確に

2. **実現可能性**:
   - リソースと期間が現実的
   - リスクと対策が具体的
   - 段階的な実施が可能

3. **ビジネス価値**:
   - ROIが明確
   - 経営目標との整合性
   - 競争優位性への貢献

4. **プレゼンテーション**:
   - 視覚的に分かりやすい
   - 論理的な流れ
   - 重要なポイントが明確

この提案書で、${context}における課題解決と価値創造を実現してください。`,
  },
  {
    name: '包括的なFAQ・ナレッジベース',
    template: (context: string) => `あなたは${context}において顧客対応と知識管理のエキスパートです。何千もの問い合わせに対応してきた経験から、本当に知りたい情報を的確に提供し、顧客満足度を高めるFAQを作成することができます。

以下のトピックに関する、実用的で包括的なFAQ・ナレッジベースを作成してください。

【作成の前提情報】

- トピック: [具体的なトピック名]
- 対象製品/サービス: [製品やサービスの詳細]
- 想定する質問者: [属性、レベル、事前知識]
- よくある問い合わせ: [実際に多い質問]
- 質問の背景: [なぜその質問が生まれるのか]
- 期待される解決: [FAQ閲覧後のゴール]
- 関連リソース: [マニュアル、サポートページなど]

【FAQ作成の品質基準】

1. **分かりやすさ**: 専門用語は最小限、必要な場合は説明
2. **具体性**: 曖昧な回答ではなく、具体的な手順や情報
3. **完全性**: 回答だけでなく背景や理由も説明
4. **実用性**: すぐに実践できる情報
5. **親切さ**: 関連情報や次のステップも提示
6. **最新性**: 古い情報や非推奨の方法は含めない

【FAQ の構成】

**■ イントロダクション**

このFAQについて:
- [トピックの簡単な説明]
- このFAQで解決できること
- 解決できない場合の問い合わせ先
- 最終更新日: [日付]

**■ カテゴリ1: 基本的な質問（Getting Started）**

**Q1-1: [最も基本的な質問]**

**A:**
[詳細な回答を以下の構成で]

• 簡潔な回答（1-2文）
  [要点を最初に]

• 詳しい説明
  [背景や理由を含めて200-300文字で]

• 具体的な手順（該当する場合）
  ステップ1: [画像や図があると良い場所を指示]
  ステップ2:
  ステップ3:

• 補足情報
  - 注意点: [見落としがちなポイント]
  - ヒント: [より良い方法や時短テクニック]
  - よくある間違い: [避けるべきこと]

• 関連質問
  → Q1-3: [関連する別の質問へのリンク]
  → Q2-1: [関連する別の質問へのリンク]

---

**Q1-2: [2番目に基本的な質問]**

[同様の形式で5-8問を作成]

---

**■ カテゴリ2: 使い方・操作方法**

**Q2-1: [具体的な操作に関する質問]**

**A:**

• 目的の確認
  この操作で実現できること: [説明]

• 前提条件
  - [必要な権限や設定]
  - [事前に準備すべきこと]

• 詳細な手順

  【方法1: 推奨される方法】
  ステップ1: [スクリーンショットがあると良い場所]
    → [具体的な操作内容]
    → [期待される結果]

  ステップ2:
    → [具体的な操作内容]
    → [期待される結果]

  所要時間: 約[X]分

  【方法2: 代替方法】
  [状況に応じた別の方法]

  メリット: [この方法の利点]
  デメリット: [注意点]

• トラブルシューティング
  ❌ エラーが表示される場合
     → 原因: [考えられる原因]
     → 解決方法: [具体的な対処法]

  ❌ 期待した結果にならない場合
     → 原因:
     → 解決方法:

• 応用例
  - [活用例1]
  - [活用例2]

---

[5-8問を同様の形式で作成]

---

**■ カテゴリ3: トラブルシューティング**

**Q3-1: [よくあるエラーや問題]**

**A:**

• 症状の確認
  [どのような状況でこの問題が起こるか]

• 原因の特定

  【パターン1】
  原因: [具体的な原因]
  確認方法: [原因を特定する方法]
  解決方法: [ステップバイステップの解決手順]

  【パターン2】
  [同様に]

• 予防策
  - [問題を未然に防ぐ方法]
  - [定期的にチェックすべきこと]

• それでも解決しない場合
  - サポートへの問い合わせ方法
  - 問い合わせ時に準備すべき情報
  - 緊急度に応じた対応フロー

---

[5-7問を作成]

---

**■ カテゴリ4: ベストプラクティス・活用テクニック**

**Q4-1: [効率的な使い方や上級者向けのテクニック]**

**A:**

• 基本的な使い方との違い
  [どのように改善されるか]

• 推奨する使い方

  **シナリオ1: [状況]の場合**
  - 設定: [推奨設定]
  - 手順: [具体的な方法]
  - 期待効果: [どれくらい効率化されるか]

  **シナリオ2: [状況]の場合**
  [同様に]

• 他のユーザーの活用例
  - 事例1: [実際の活用例と成果]
  - 事例2:

• さらに学ぶには
  - [参考資料やドキュメント]
  - [トレーニングコース]
  - [コミュニティ]

---

[3-5問を作成]

---

**■ カテゴリ5: 仕様・制限事項**

**Q5-1: [仕様や制限に関する質問]**

**A:**

• 現在の仕様
  [具体的な仕様の説明]

• なぜこの仕様なのか
  [技術的背景や設計思想]

• 制限事項
  - [制限1]: [詳細と影響範囲]
  - [制限2]: [詳細と影響範囲]

• ワークアラウンド（回避策）
  [制限を補う方法]

• 将来の予定
  - [アップデート情報]
  - [改善予定]
  - [フィードバックの送り方]

---

[3-5問を作成]

---

**■ カテゴリ6: セキュリティ・プライバシー**

[該当する場合のみ、3-5問を作成]

---

**■ カテゴリ7: 料金・プラン**

[該当する場合のみ、3-5問を作成]

---

**■ よくある質問TOP10**

実際の問い合わせ件数に基づく、最もよくある質問：

1. [Q番号]: [質問文]
2. [Q番号]: [質問文]
3. [Q番号]: [質問文]
...
10. [Q番号]: [質問文]

---

**■ 検索できない場合**

• 問い合わせ前のセルフチェック
  □ [確認事項1]
  □ [確認事項2]
  □ [確認事項3]

• サポートへの問い合わせ
  - 窓口: [連絡先]
  - 対応時間: [営業時間]
  - 平均応答時間: [目安]
  - 問い合わせ時のテンプレート:
    【問い合わせ内容】
    [内容を具体的に]

    【発生状況】
    - 発生日時:
    - 頻度:
    - 環境:

    【試した対処法】
    [すでに試したこと]

• フィードバックのお願い
  - このFAQで解決できましたか？
  - 改善提案: [フィードバックフォーム]

---

**■ 用語集**

このFAQで使用される専門用語の解説：

- **[用語1]**: [わかりやすい説明]
- **[用語2]**: [わかりやすい説明]

---

**■ 関連リソース**

• 公式ドキュメント
  - [リンク1]: [説明]
  - [リンク2]: [説明]

• チュートリアル動画
  - [リンク1]: [説明]

• コミュニティ
  - [フォーラム]
  - [ユーザーグループ]

• 最新情報
  - [ブログ]
  - [リリースノート]

このFAQは${context}の実務経験に基づいて作成されており、実際のユーザーの質問と回答を反映しています。定期的に更新され、常に最新の情報を提供します。`,
  },
];

/**
 * AIを使って高品質なプロンプトを生成する
 * 注: 実際の実装ではOpenAI APIやClaude APIを呼び出す
 */
export async function generateHighQualityPrompts(
  category: string,
  businessContext: string,
  count: number
): Promise<Prompt[]> {
  // TODO: 実際のAI API呼び出しに置き換える
  // const response = await callAIAPI(META_PROMPT, category, businessContext, count);

  // デモ用の高品質なプロンプト生成
  await new Promise((resolve) => setTimeout(resolve, 2000));

  // @ts-expect-error - 将来のAI API統合のために保持
  const _categoryContext = CATEGORY_CONTEXTS[category] || 'この業務領域';
  const prompts: Prompt[] = [];

  // 用途カテゴリの自動マッピング
  const inferUseCases = (title: string, context: string): string[] => {
    const useCases: string[] = [];
    const combined = (title + ' ' + context).toLowerCase();

    if (combined.match(/文書|メール|レター|報告|コピー|記事|作成|執筆/)) useCases.push('writing');
    if (combined.match(/分析|データ|統計|評価|測定|解析/)) useCases.push('analysis');
    if (combined.match(/コミュニケーション|メール|会話|対話|連絡/)) useCases.push('communication');
    if (combined.match(/企画|計画|戦略|プラン|スケジュール/)) useCases.push('planning');
    if (combined.match(/リサーチ|調査|情報収集|検索|研究/)) useCases.push('research');
    if (combined.match(/クリエイティブ|創造|アイデア|デザイン|制作/)) useCases.push('creative');
    if (combined.match(/自動化|効率化|ツール|スクリプト|システム/)) useCases.push('automation');
    if (combined.match(/学習|教育|研修|トレーニング|指導/)) useCases.push('learning');

    return useCases.length > 0 ? useCases : ['writing']; // デフォルトは文章作成
  };

  for (let i = 0; i < Math.min(count, PROMPT_PATTERNS.length); i++) {
    const pattern = PROMPT_PATTERNS[i % PROMPT_PATTERNS.length];
    const title = `${businessContext} - ${pattern.name}`;
    const prompt: Prompt = {
      id: `generated-${Date.now()}-${i}`,
      title,
      content: pattern.template(businessContext),
      category,
      useCase: inferUseCases(title, businessContext), // 自動的に用途を推定
      tags: [businessContext, pattern.name, 'AI生成'],
      usage: `このプロンプトは${businessContext}の${pattern.name}を支援します。角括弧[]で囲まれた部分に具体的な情報を入力してご使用ください。`,
      example: `例: [項目1]に具体的な情報を入力し、AIに送信してください。`,
      isPremium: false,
      createdAt: new Date().toISOString(),
      updatedAt: new Date().toISOString(),
    };
    prompts.push(prompt);
  }

  // 追加の専門的なプロンプトパターン
  const ADDITIONAL_PATTERNS = [
    {
      name: 'メール・ビジネス文書テンプレート',
      template: `あなたは${businessContext}におけるビジネスコミュニケーションのエキスパートです。相手に好印象を与え、目的を達成するメール・文書を作成します。

【作成する文書の種類】
[種類を指定: 依頼メール/お礼メール/お詫びメール/提案書/報告書/議事録など]

【コミュニケーションの目的】
- 主な目的: [何を伝えたいか、何をしてほしいか]
- 二次的な目的: [関係構築、情報共有など]

【相手の情報】
- 宛先: [役職、関係性、性格、バックグラウンド]
- 相手の関心事: [何を重視しているか]
- 期待される反応: [どう行動してほしいか]

【状況・背景】
- これまでの経緯: [関連するやり取りや出来事]
- 緊急度: [至急/通常/情報共有]
- 重要度: [高/中/低]

【文書作成の要件】

**1. 構成**
• 件名/タイトル
  - 内容が一目で分かる
  - 緊急度や重要度が伝わる
  - 開封したくなる工夫

• 冒頭の挨拶
  - 関係性に応じた適切な挨拶
  - 必要に応じて時候の挨拶

• 本文
  - 結論を先に（PREP法: Point → Reason → Example → Point）
  - 段落ごとに1つのトピック
  - 箇条書きで読みやすく
  - 具体的な数字や事実を含める

• 依頼・提案部分
  - 何をしてほしいか明確に
  - 期限や条件を具体的に
  - 相手のメリットも提示

• 結びの言葉
  - 感謝の気持ち
  - 次のアクションの提示
  - 適切な締めの挨拶

**2. トーンとスタイル**
- 敬語レベル: [最上級敬語/丁寧語/カジュアル]
- 文体: [堅い/柔らかい/親しみやすい]
- 長さ: [簡潔/標準/詳細]

**3. チェックポイント**
□ 相手を不快にさせる表現はないか
□ 誤解を招く曖昧な表現はないか
□ 必要な情報は全て含まれているか
□ 期限や数字は正確か
□ 添付ファイルの言及は適切か

**4. NG表現を避ける**
- 「お忙しいところ恐縮ですが」（多用しない）
- 「よろしくお願いします」（具体性に欠ける）
- 受動態の多用（主体性がない印象）
- 二重敬語（「お伺いさせていただく」など）

**5. 良い表現の例**
- 「〇月〇日までにご回答いただけますと幸いです」
- 「ご検討の上、〇〇についてご意見をお聞かせください」
- 「〇〇の件について、以下の3点を確認させてください」

実務で即使える、プロフェッショナルな文書を作成してください。`,
    },
    {
      name: '会議・プレゼンテーション準備',
      template: `あなたは${businessContext}におけるプレゼンテーションとファシリテーションのスペシャリストです。聴衆を引き込み、目的を達成する会議・プレゼンを設計します。

【会議・プレゼンの基本情報】
- 種類: [報告会/提案会/ブレスト/意思決定会議/キックオフなど]
- 目的: [何を達成したいか]
- 所要時間: [分]
- 参加者: [人数、役職、事前知識レベル]
- 場所・形式: [対面/オンライン/ハイブリッド]

【準備すべき内容】

**1. アジェンダ設計**
• オープニング（5-10%）
  - アイスブレイク（必要に応じて）
  - 会議の目的と期待する成果の共有
  - タイムテーブルの確認

• メインコンテンツ（70-80%）
  セクション1: [テーマ] [〇〇分]
    - キーメッセージ: [伝えたいこと]
    - 説明方法: [データ/ストーリー/デモ]
    - 想定される質問と回答

  セクション2: [テーマ] [〇〇分]
    [同様に]

  セクション3: [テーマ] [〇〇分]
    [同様に]

• ディスカッション（10-15%）
  - 論点の明確化
  - 参加者の意見収集
  - 合意形成

• クロージング（5%）
  - 決定事項の確認
  - ネクストアクションの明確化
  - 感謝の言葉

**2. スライド構成（該当する場合）**

スライド1: タイトルスライド
- 魅力的なタイトル
- 日付、発表者

スライド2: アジェンダ
- 今日話すこと3-5点
- 所要時間の目安

スライド3-5: 現状分析
- データとビジュアル
- 問題提起
- なぜ今このテーマなのか

スライド6-10: 提案・解決策
- 具体的な内容
- ビフォーアフター
- 実現可能性

スライド11-12: 実行計画
- タイムライン
- 役割分担
- マイルストーン

スライド13: まとめ
- 3つの重要ポイント
- 次のステップ

**3. プレゼンテーション技法**

• ストーリーテリング
  - 導入: 問題提起、共感を得る
  - 展開: データと論理で説得
  - 結論: 行動喚起

• データの見せ方
  - 1スライド1メッセージ
  - 大きな数字は視覚的に
  - 比較は表やグラフで

• 聴衆の関心を保つ工夫
  - 3の法則（ポイントは3つ）
  - ストーリーや具体例を入れる
  - 質問を投げかける
  - 適度な間を取る

**4. 想定Q&A**

Q1: [予想される質問]
A: [データや根拠を示した回答]

Q2: [厳しい質問]
A: [正直に答えつつ前向きな提案]

Q3: [技術的な質問]
A: [詳細と簡潔版の両方を用意]

**5. リスク対策**

• 時間超過の場合
  - 優先度の低いセクションを特定
  - スキップしても伝わる設計

• 技術トラブルの場合
  - 紙の資料を準備
  - デモは録画も用意

• 反対意見が出た場合
  - 傾聴の姿勢
  - 共通点を見つける
  - 別途discussion の場を設定

**6. 事前準備チェックリスト**

□ 資料は完成し、関係者に事前送付済み
□ 会議室/Zoom URLの確認
□ プロジェクター/画面共有のテスト
□ タイムキーパーの依頼
□ 参加者の事前質問を収集
□ アジェンダは参加者に共有済み
□ リハーサル実施済み

${businessContext}の専門知識を活かし、成功する会議・プレゼンを実現してください。`,
    },
    {
      name: 'データ分析とレポート自動化',
      template: `あなたは${businessContext}におけるデータアナリストです。複雑なデータから価値ある洞察を引き出し、意思決定に役立つレポートを作成します。

【分析の前提条件】
- データソース: [どこから取得するデータか]
- データ期間: [分析対象期間]
- データ量: [レコード数、ファイルサイズ]
- データ形式: [CSV/Excel/データベース/API]
- 分析ツール: [Excel/Python/R/BI ツール]

【分析プロセス】

**フェーズ1: データ理解と準備**

1. データの読み込みと確認
   - 件数、カラム数の確認
   - データ型の確認
   - 欠損値の確認
   - 異常値の検出

2. データクレンジング
   - 欠損値の処理方法:
     • 削除する場合の基準
     • 補完する場合の方法（平均/中央値/前後の値）
   - 異常値の処理:
     • 外れ値の定義（3σ/IQR）
     • 処理方法（除外/補正/そのまま）
   - データ型の変換:
     • 日付形式の統一
     • カテゴリ変数のエンコーディング

3. 特徴量エンジニアリング
   - 既存データから新しい指標を作成:
     • [例: 売上から成長率を計算]
     • [例: 日付から曜日・月を抽出]
     • [例: 顧客行動から RFM スコア算出]

**フェーズ2: 探索的データ分析（EDA）**

1. 記述統計
   - 平均、中央値、最頻値
   - 標準偏差、分散
   - 最大値、最小値、四分位数
   - 分布の可視化（ヒストグラム、箱ひげ図）

2. 相関分析
   - 変数間の相関係数
   - 散布図マトリクス
   - ヒートマップによる可視化

3. セグメント分析
   - [例: 顧客セグメント別の売上]
   - [例: 地域別のパフォーマンス]
   - [例: 時系列での変化]

4. トレンド分析
   - 時系列データの可視化
   - 移動平均の計算
   - 季節性の検出
   - 前年同月比、前月比の算出

**フェーズ3: 深掘り分析**

1. 仮説検証
   仮説1: [例: プロモーション期間は売上が増加する]
   - 検証方法: [対応のあるt検定]
   - 結果の解釈: [有意差の有無]

   仮説2: [例: 顧客満足度と再購入率に相関がある]
   - 検証方法: [回帰分析]
   - 結果の解釈: [相関の強さと方向]

2. セグメンテーション
   - クラスタリング手法の適用
   - 各セグメントの特徴抽出
   - ビジネスへの示唆

3. 予測分析（該当する場合）
   - モデルの選択: [線形回帰/時系列分析/機械学習]
   - 予測精度の評価: [RMSE/MAE/R²]
   - 予測結果の可視化

**フェーズ4: レポート作成**

**エグゼクティブサマリー**
• 3つの重要な発見
  1. [データに基づく発見1]
  2. [データに基づく発見2]
  3. [データに基づく発見3]

• 推奨アクション
  - [具体的な推奨事項]

**詳細分析結果**

セクション1: 全体概況
- KPIの現状値
- 目標との乖離
- 前期との比較
→ グラフ: [折れ線グラフ/棒グラフ]

セクション2: セグメント別分析
- 各セグメントのパフォーマンス
- 成長/減少セグメントの特定
- 原因の仮説
→ グラフ: [積み上げグラフ/ヒートマップ]

セクション3: 問題点と機会
- 課題の優先順位付け
- 改善の余地がある領域
- 未活用の機会
→ グラフ: [散布図/バブルチャート]

セクション4: 推奨施策
- データに基づく提案
- 期待される効果の試算
- 実施スケジュール案

**データビジュアライゼーション**

効果的なグラフの選び方:
- 時系列データ → 折れ線グラフ
- 比較 → 棒グラフ
- 割合 → 円グラフ
- 相関 → 散布図
- 分布 → ヒストグラム
- 地域別 → 地図・ヒートマップ

グラフ作成の原則:
- タイトルは具体的に（「売上推移」ではなく「2024年Q1-Q4売上推移：前年比15%増」）
- 軸ラベルと単位を明記
- 色の使い方に一貫性
- 重要な部分をハイライト
- 説明文を付ける

**自動化のポイント**

再利用可能なレポート設計:
- パラメータ化（期間、セグメントを変更可能に）
- テンプレート化（定型レポートは自動生成）
- データ更新の仕組み（手動/自動）
- アラート設定（異常値検知時に通知）

${businessContext}のデータから最大の価値を引き出してください。`,
    },
    {
      name: 'トラブルシューティングガイド',
      template: `あなたは${businessContext}における問題解決のエキスパートです。システマティックにトラブルの原因を特定し、効率的に解決する方法を提供します。

【トラブルの情報】
- 問題の概要: [何が起こっているか]
- 発生頻度: [常に/間欠的/初めて]
- 影響範囲: [誰が/何が影響を受けているか]
- 緊急度: [至急/高/中/低]
- 発生し始めた時期: [いつから]
- 最近の変更: [システム変更、設定変更など]

【トラブルシューティングの体系的アプローチ】

**ステップ1: 問題の切り分け**

1. 症状の正確な把握
   - エラーメッセージの全文（あれば）
   - スクリーンショットや動画
   - 再現手順の詳細
   - 期待される動作 vs 実際の動作

2. 環境の確認
   □ OS/ブラウザのバージョン
   □ 使用しているツール/ソフトウェアのバージョン
   □ ネットワーク接続状況
   □ 権限設定
   □ 最近のアップデート有無

3. 範囲の特定
   - 特定のユーザーのみ？全員？
   - 特定の環境のみ？全環境？
   - 特定の操作のみ？全操作？
   - 特定の時間帯のみ？常に？

**ステップ2: 原因の仮説立案**

考えられる原因を列挙:

【可能性: 高】
1. [原因候補1]
   - なぜこう考えるか: [理由]
   - 確認方法: [具体的なチェック項目]
   - 過去の事例: [類似ケース]

2. [原因候補2]
   [同様に]

【可能性: 中】
[同様に3-5項目]

【可能性: 低（念のため確認）】
[同様に2-3項目]

**ステップ3: 検証と診断**

仮説ごとの検証手順:

**仮説1の検証**
□ ステップ1: [確認内容]
  → 結果: [OK/NG]
  → OK の場合: [次の確認へ]
  → NG の場合: [原因特定、解決策へ]

□ ステップ2: [確認内容]
  [同様に]

**診断ツールの活用**
- ログファイルの確認場所: [パス]
- 確認すべきログのキーワード: [エラーコード、メッセージ]
- デバッグモードの有効化方法:  [手順]
- ネットワーク診断コマンド: [ping/traceroute/nslookup]

**ステップ4: 解決策の実行**

**解決策A: [原因Aに対する対策]**（推奨）

• 概要
  [何をするか簡潔に]

• 詳細な手順
  ステップ1: [具体的な操作]
    - 注意点: [気をつけるべきこと]
    - 予想される結果: [こうなれば成功]

  ステップ2:
    [同様に]

• 所要時間: 約[X]分

• リスク: [この対策のリスクとその回避方法]

• 元に戻す方法: [失敗時のロールバック手順]

**解決策B: [代替案]**
[同様の形式、より簡潔に]

**解決策C: [一時的な回避策]**
根本解決ではないが、急ぎの場合の対処法

**ステップ5: 効果の確認**

□ 問題が解決したことを確認
  - テスト方法: [具体的な確認手順]
  - 確認項目:
    □ [項目1]
    □ [項目2]
    □ [項目3]

□ 副作用がないことを確認
  - 他の機能への影響
  - パフォーマンスへの影響

□ 再発防止策の実施
  - [予防的な設定変更]
  - [監視の強化]
  - [ドキュメント更新]

**ステップ6: ドキュメント化**

今後のために記録:

【トラブル記録】
- 発生日時:
- 問題内容:
- 根本原因:
- 解決策:
- 解決までの所要時間:
- 担当者:

【予防策】
- 同じ問題を防ぐために:
- 早期発見のために:
- 影響を最小化するために:

**それでも解決しない場合**

エスカレーションの基準:
- [X]分経過しても進展なし
- ビジネスへの影響が[規模]以上
- 原因がまったく不明

エスカレーション先:
- 第1段階: [部門/担当者]
- 第2段階: [部門/担当者]
- 緊急時: [連絡先]

問い合わせ時に準備する情報:
- これまでに試した対処法
- エラーログ
- 環境情報
- 再現手順

**よくあるトラブルとクイックフィックス**

| 問題 | 原因 | 解決策 | 所要時間 |
|-----|------|--------|---------|
| [問題1] | [原因] | [対策] | [分] |
| [問題2] | [原因] | [対策] | [分] |
| [問題3] | [原因] | [対策] | [分] |

${businessContext}の問題を迅速かつ的確に解決してください。`,
    },
  ];

  // パターンを超える場合は追加パターンを使用
  for (let i = PROMPT_PATTERNS.length; i < count; i++) {
    const additionalIndex = (i - PROMPT_PATTERNS.length) % ADDITIONAL_PATTERNS.length;
    const pattern = ADDITIONAL_PATTERNS[additionalIndex];

    const prompt: Prompt = {
      id: `generated-${Date.now()}-${i}`,
      title: `${businessContext} - ${pattern.name}`,
      content: pattern.template,
      category,
      tags: [businessContext, pattern.name, 'AI生成', '詳細ガイド'],
      usage: `このプロンプトは${businessContext}の${pattern.name}を支援します。各セクションの角括弧[]で囲まれた部分に具体的な情報を入力してご使用ください。`,
      example: `例: 具体的な業務内容や状況を角括弧内に記入し、AIに送信することで、カスタマイズされた詳細なガイドが得られます。`,
      isPremium: i % 2 === 0, // 半分はプレミアム
      createdAt: new Date().toISOString(),
      updatedAt: new Date().toISOString(),
    };
    prompts.push(prompt);
  }

  return prompts;
}

/**
 * プロンプトの品質スコアを計算
 */
export function calculatePromptQuality(prompt: Prompt): number {
  let score = 0;

  // タイトルの明確性
  if (prompt.title.length >= 10 && prompt.title.length <= 50) score += 20;

  // コンテンツの構造化
  if (prompt.content.includes('【') && prompt.content.includes('】')) score += 20;

  // 具体的な指示
  if (prompt.content.includes('[') && prompt.content.includes(']')) score += 15;

  // 箇条書きの使用
  if (prompt.content.includes('- ') || prompt.content.includes('1. ')) score += 15;

  // 適切な長さ
  if (prompt.content.length >= 200 && prompt.content.length <= 2000) score += 15;

  // タグの充実度
  if (prompt.tags && prompt.tags.length >= 2) score += 10;

  // 使用方法の記載
  if (prompt.usage && prompt.usage.length > 0) score += 5;

  return score;
}
